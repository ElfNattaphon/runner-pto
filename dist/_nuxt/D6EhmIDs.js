import{_ as P}from"./CLgWZ-ys.js";import{g as K,s as b,n as N,m as y,j as D,w as M,o as n,a as e,c as u,k as S,q as a,t as d,x as h,y as k,z as x,C as w,A as U,b as V,d as B,F as L,r as O}from"./C-ajaEJa.js";import{C as F}from"./BLUqDWYA.js";import{_ as R}from"./DssN87-j.js";import{_ as W}from"./BjgJzNh4.js";import{u as j}from"./BmBLMpJm.js";const E={key:0,class:"rounded-xl border border-white/10 p-4 bg-ink-800/60 mb-4"},H={class:"flex items-center justify-between"},q={class:"text-sm text-gray-400"},z={class:"md:col-span-1"},A={class:"md:col-span-1"},I={class:"md:col-span-1"},G={class:"md:col-span-1"},J={class:"md:col-span-4 flex items-center gap-3"},Q={key:2,class:"mt-6"},X={class:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4"},Y={class:"text-sm text-gray-400"},Z={class:"font-medium text-white"},tt={class:"text-sm text-gray-400 mt-1"},et={class:"mt-2"},dt=K({__name:"planner",setup(st){const m=b(10),c=b(new Date(Date.now()+1e3*60*60*24*84).toISOString().slice(0,10)),p=b(null),f=b("Sat"),r=N(),v=y(()=>r.workouts),g=y(()=>r.planMeta),_=y(()=>v.value.length>0),i=j(),$=o=>{if(!o)return"—";const t=Math.floor(o/3600),l=Math.floor(o%3600/60),s=o%60;return`${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(s).padStart(2,"0")}`},C=async()=>{if(confirm("ยืนยันลบแผนปัจจุบันทั้งหมด?"))try{const t=await $fetch("/api/plan/delete",{method:"POST"});i.success(`ลบแผนแล้ว (${t.deleted})`),r.setWorkouts([]),r.setMeta({})}catch(t){i.error(t?.statusMessage||"ลบแผนไม่สำเร็จ")}},T=async()=>{try{const o=await $fetch("/api/plan/generate",{method:"POST",body:{distanceKm:m.value,raceDate:c.value,goalSeconds:p.value,longRunDay:f.value}});r.setWorkouts(o.workouts||[]),o?.meta&&r.setMeta(o.meta),i.success("สร้างแผนสำเร็จ")}catch(o){if(o?.statusCode===409){if(confirm(`คุณมีแผนเดิมอยู่ ต้องลบออกก่อนสร้างใหม่
ต้องการลบแผนเดิมตอนนี้หรือไม่?`))try{const l=await $fetch("/api/plan/delete",{method:"POST"});i.info(`ลบแผนเดิมแล้ว (${l.deleted} รายการ) ลองกดสร้างอีกครั้ง`)}catch(l){i.error(l?.statusMessage||"ลบแผนเดิมไม่สำเร็จ")}}else i.error(o?.statusMessage||"สร้างแผนไม่สำเร็จ")}};return(o,t)=>{const l=P;return n(),D(F,null,{default:M(()=>[t[15]||(t[15]=e("h2",{class:"text-xl font-semibold mb-4"},"สร้างตารางซ้อม",-1)),a(_)?(n(),u("div",E,[e("div",H,[e("div",null,[t[4]||(t[4]=e("div",{class:"font-medium"},"มีแผนปัจจุบันอยู่แล้ว",-1)),e("div",q,"ระยะ "+d(a(g).distanceKm||"—")+" กม. | เวลาเป้าหมาย "+d($(a(g).goalSeconds))+" | วันแข่ง "+d(a(g).raceDate?new Date(a(g).raceDate).toLocaleDateString():"—"),1)]),e("button",{class:"btn-ghost",onClick:h(C,["prevent"])},"ลบแผนเดิม")]),t[5]||(t[5]=e("p",{class:"text-xs text-gray-400 mt-2"},"ต้องลบแผนเดิมก่อน จึงจะสร้างแผนใหม่ได้",-1))])):S("",!0),a(_)?S("",!0):(n(),u("form",{key:1,onSubmit:h(T,["prevent"]),class:"grid md:grid-cols-4 gap-4"},[e("div",z,[t[7]||(t[7]=e("label",{class:"form-label"},"ระยะ",-1)),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>x(m)?m.value=s:null),class:"form-input"},[...t[6]||(t[6]=[e("option",{value:5},"5K",-1),e("option",{value:10},"10K",-1),e("option",{value:21.097},"Half Marathon",-1),e("option",{value:42.195},"Marathon",-1),e("option",{value:1.5},"1500m (ลู่)",-1)])],512),[[w,a(m),void 0,{number:!0}]])]),e("div",A,[t[8]||(t[8]=e("label",{class:"form-label"},"วันแข่ง",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>x(c)?c.value=s:null),type:"date",class:"form-input"},null,512),[[U,a(c)]])]),e("div",I,[t[10]||(t[10]=e("label",{class:"form-label"},"วันวิ่งยาว",-1)),k(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>x(f)?f.value=s:null),class:"form-input"},[...t[9]||(t[9]=[e("option",{value:"Mon"},"จันทร์",-1),e("option",{value:"Tue"},"อังคาร",-1),e("option",{value:"Wed"},"พุธ",-1),e("option",{value:"Thu"},"พฤหัสฯ",-1),e("option",{value:"Fri"},"ศุกร์",-1),e("option",{value:"Sat"},"เสาร์",-1),e("option",{value:"Sun"},"อาทิตย์",-1)])],512),[[w,a(f)]])]),e("div",G,[t[11]||(t[11]=e("label",{class:"form-label"},"เวลาเป้าหมาย (hh:mm:ss)",-1)),V(W,{modelValue:a(p),"onUpdate:modelValue":t[3]||(t[3]=s=>x(p)?p.value=s:null)},null,8,["modelValue"])]),e("div",J,[t[13]||(t[13]=e("button",{class:"btn-accent"},"สร้างแผน",-1)),a(v).length?(n(),D(l,{key:0,to:"/calendar",class:"btn-ghost"},{default:M(()=>[...t[12]||(t[12]=[B("ดูใน Calendar",-1)])]),_:1})):S("",!0)])],32)),a(v).length?(n(),u("div",Q,[t[14]||(t[14]=e("h3",{class:"font-semibold mb-3"},"ตัวอย่างสัปดาห์แรก",-1)),e("div",X,[(n(!0),u(L,null,O(a(v).slice(0,7),s=>(n(),u("div",{key:s.id,class:"rounded-xl border border-white/10 p-4 bg-ink-800/60"},[e("div",Y,d(new Date(s.date).toLocaleDateString()),1),e("div",Z,d(s.title),1),e("div",tt,d(s.details),1),e("div",et,[V(R,{type:s.type},null,8,["type"])])]))),128))])])):S("",!0)]),_:1})}}});export{dt as default};
