import{g as h,c as Z,o as V,a as o,t as d,l as v,D as y,m as $,j as H,w as R,x as S,b as n,q as e,y as w,C as k}from"./C-ajaEJa.js";import{c}from"./TqiFiJ8V.js";import{C as U}from"./BLUqDWYA.js";import{_ as f}from"./BjgJzNh4.js";import{u as C}from"./BmBLMpJm.js";const Y={class:"form-label"},N=["value"],r=h({__name:"FormField",props:{label:{},modelValue:{default:""}},emits:["update:modelValue"],setup(x,{emit:m}){const i=m;return(u,p)=>(V(),Z("div",null,[o("label",Y,d(u.label),1),o("input",{value:u.modelValue,onInput:p[0]||(p[0]=g=>i("update:modelValue",g.target.value)),class:"form-input"},null,40,N)]))}}),T={class:"text-xs text-gray-400 mt-1"},A={class:"space-y-1"},K={class:"mt-3 rounded-lg border border-white/10 p-3 bg-ink-800/60"},B={class:"text-xs text-gray-300 space-y-1"},D={class:"space-y-1"},E={class:"mt-3 rounded-lg border border-white/10 p-3 bg-ink-800/60"},F={class:"text-xs text-gray-300 space-y-1"},I={class:"space-y-1"},O=h({__name:"profile",async setup(x){let m,i;const u=C(),p=([m,i]=v(()=>$fetch("/api/auth/me")),m=await m,i(),m),l=y({...{fullName:null,dob:null,sex:null,daysAvailable:null,ageYears:null,hrMethod:"max"},...p?.profile||{}}),t=$(()=>c({method:l.hrMethod||"max",maxHR:l.maxHR??null,thresholdHR:l.thresholdHR??null,ageYears:l.ageYears??null})),M=async()=>{try{const b={fullName:l.fullName??null,dob:l.dob??null,sex:l.sex??null,heightCm:l.heightCm??null,weightKg:l.weightKg??null,maxHR:l.maxHR??null,thresholdHR:l.thresholdHR??null,weeklyMileage:l.weeklyMileage??null,daysAvailable:l.daysAvailable??null,best5kSeconds:l.best5kSeconds??null,best10kSeconds:l.best10kSeconds??null,bestHMSeconds:l.bestHMSeconds??null,bestMarSeconds:l.bestMarSeconds??null,ageYears:l.ageYears??null,hrMethod:l.hrMethod??"max"},s=await $fetch("/api/profile/update",{method:"POST",body:b});u.success("บันทึกโปรไฟล์แล้ว"),s&&s.persistedAgeHr===!1&&u.info("บันทึกแล้ว แต่ฐานข้อมูลยังไม่รองรับ ageYears/hrMethod — แนะนำให้รัน prisma migrate dev")}catch(b){u.error(b?.statusMessage||"บันทึกโปรไฟล์ไม่สำเร็จ")}};return(b,s)=>(V(),H(U,null,{default:R(()=>[s[18]||(s[18]=o("h2",{class:"text-xl font-semibold mb-4"},"โปรไฟล์นักวิ่ง",-1)),o("form",{onSubmit:S(M,["prevent"]),class:"grid md:grid-cols-2 gap-4"},[n(r,{modelValue:e(l).heightCm,"onUpdate:modelValue":s[0]||(s[0]=a=>e(l).heightCm=a),modelModifiers:{number:!0},label:"ส่วนสูง (ซม.)"},null,8,["modelValue"]),n(r,{modelValue:e(l).weightKg,"onUpdate:modelValue":s[1]||(s[1]=a=>e(l).weightKg=a),modelModifiers:{number:!0},label:"น้ำหนัก (กก.)"},null,8,["modelValue"]),n(r,{modelValue:e(l).maxHR,"onUpdate:modelValue":s[2]||(s[2]=a=>e(l).maxHR=a),modelModifiers:{number:!0},label:"Max HR"},null,8,["modelValue"]),n(r,{modelValue:e(l).thresholdHR,"onUpdate:modelValue":s[3]||(s[3]=a=>e(l).thresholdHR=a),modelModifiers:{number:!0},label:"Threshold HR"},null,8,["modelValue"]),n(r,{modelValue:e(l).weeklyMileage,"onUpdate:modelValue":s[4]||(s[4]=a=>e(l).weeklyMileage=a),modelModifiers:{number:!0},label:"วิ่งต่อสัปดาห์ (กม.)"},null,8,["modelValue"]),n(r,{modelValue:e(l).ageYears,"onUpdate:modelValue":s[5]||(s[5]=a=>e(l).ageYears=a),modelModifiers:{number:!0},label:"อายุ (ปี)"},null,8,["modelValue"]),o("div",null,[s[11]||(s[11]=o("label",{class:"form-label"},"วิธีคำนวณโซนหัวใจ",-1)),w(o("select",{"onUpdate:modelValue":s[6]||(s[6]=a=>e(l).hrMethod=a),class:"form-input"},[...s[10]||(s[10]=[o("option",{value:"max"},"จากอายุ (Max HR ~ 220-อายุ)",-1),o("option",{value:"threshold"},"จาก Threshold HR (LTHR)",-1)])],512),[[k,e(l).hrMethod]]),o("p",T,"Max HR (ประมาณ): "+d(e(l).ageYears?220-Number(e(l).ageYears):"—")+" bpm",1)]),o("div",A,[s[12]||(s[12]=o("label",{class:"form-label"},"สถิติ 10K (hh:mm:ss)",-1)),n(f,{modelValue:e(l).best10kSeconds,"onUpdate:modelValue":s[7]||(s[7]=a=>e(l).best10kSeconds=a)},null,8,["modelValue"])]),o("div",K,[s[13]||(s[13]=o("div",{class:"text-sm font-medium mb-1"},"โซนหัวใจ (ตามค่าที่เลือก)",-1)),o("ul",B,[o("li",null,"Easy / Long Run: "+d(e(t)?`${e(t).Z2[0]}–${e(t).Z2[1]} bpm (Z2)`:"—"),1),o("li",null,"Marathon: "+d(e(t)?`${e(t).Z3[0]}–${e(t).Z3[1]} bpm (Z3)`:"—"),1),o("li",null,"Tempo: "+d(e(t)?`${e(t).Z3[0]}–${e(t).Z4[1]} bpm (Z3–Z4)`:"—"),1),o("li",null,"Intervals: "+d(e(t)?`${e(t).Z4[0]}–${e(t).Z4[1]} bpm (Z4)`:"—"),1),o("li",null,"Reps: "+d(e(t)?`${e(t).Z5[0]}–${e(t).Z5[1]} bpm (Z5)`:"—"),1)])]),o("div",D,[s[14]||(s[14]=o("label",{class:"form-label"},"สถิติ Half (hh:mm:ss)",-1)),n(f,{modelValue:e(l).bestHMSeconds,"onUpdate:modelValue":s[8]||(s[8]=a=>e(l).bestHMSeconds=a)},null,8,["modelValue"])]),o("div",E,[s[15]||(s[15]=o("div",{class:"text-sm font-medium mb-1"},"โซนหัวใจ (ตามค่าที่เลือก)",-1)),o("ul",F,[o("li",null,"Easy / Long Run: "+d(e(t)?`${e(t).Z2[0]}–${e(t).Z2[1]} bpm (Z2)`:"—"),1),o("li",null,"Marathon: "+d(e(t)?`${e(t).Z3[0]}–${e(t).Z3[1]} bpm (Z3)`:"—"),1),o("li",null,"Tempo: "+d(e(t)?`${e(t).Z3[0]}–${e(t).Z4[1]} bpm (Z3–Z4)`:"—"),1),o("li",null,"Intervals: "+d(e(t)?`${e(t).Z4[0]}–${e(t).Z4[1]} bpm (Z4)`:"—"),1),o("li",null,"Reps: "+d(e(t)?`${e(t).Z5[0]}–${e(t).Z5[1]} bpm (Z5)`:"—"),1)])]),o("div",I,[s[16]||(s[16]=o("label",{class:"form-label"},"สถิติ Full (hh:mm:ss)",-1)),n(f,{modelValue:e(l).bestMarSeconds,"onUpdate:modelValue":s[9]||(s[9]=a=>e(l).bestMarSeconds=a)},null,8,["modelValue"])]),s[17]||(s[17]=o("div",{class:"md:col-span-2"},[o("button",{class:"btn-primary"},"บันทึก")],-1))],32)]),_:1}))}});export{O as default};
